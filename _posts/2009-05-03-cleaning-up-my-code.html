---
layout: post
title: "Cleaning up my code"
date: 2009-05-03
comments: false
---

<div class='post'>
<p style="clear: both">I've been reading <a href="http://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">Clean Code</a> that I listed on my list books to get through. I've read a bunch of code improvement books, but there were a couple chapters that I've gone through that I liked so far.</p><p style="clear: both"><strong>Writing clear functions</strong></p><p style="clear: both">We've all heard that we should write functions that only do one thing. But how many of us really do it? Here is an example of how I used to write code.</p><blockquote style="clear: both"><p><strong>public void mouseClicked(MouseEvent event) {</strong><br /><br /> // Let's do something on a primary button double-click<br /> if (event.getButton() == MouseEvent.BUTTON1 &amp;&amp; event.getClickCount() == 2) { <br /> // do something<br /><br /><strong>}</strong><br /></p></blockquote><p style="clear: both">Inline comments are evil. If they aren't updated, which can happen frequently, why not write a method that can't lie. What I should be doing is writing methods with clear names that inform developers of my intent. </p><p style="clear: both">Inline comments can be out of date, in the wrong place, or just plain wrong. Method names get updated automatically if you refactor your code and if the method name is wrong, the compiler let's you know.</p><p style="clear: both">Here is how the code should look:</p><blockquote style="clear: both"><p><strong>public void mouseClicked(MouseEvent event) {</strong><br /><br />if (this.isPrimaryButtonDoubleClick(event)) {<br />// do something<br />}<br /><br /><strong>}</strong><br /><br /><strong>public boolean isPrimaryButtonDoubleClick(MouseEvent event){</strong><br /><br /> return event.getButton() == MouseEvent.BUTTON1 &amp;&amp; event.getClickCount() == 2;<br /><br /><strong>}</strong></p></blockquote><p style="clear: both">The code is trivial, but when your methods and classes get larger, readability and intent become increasingly more important. The longer developers have to stop and think about what your code is doing, the more it needs to be refactored. Here is what a developer might be thinking when they read my old code example:</p><p style="clear: both"><em>"We want to do something when BUTTON1 is pressed and we click twice". "What is MouseEvent.BUTTON1"? *Stop to read some java docs* "So we get the click count twice. Oh thats a double-click!"</em></p><p style="clear: both">You might think that someone should immediately associate the clause to a double-click, but you might have to stop and think if you aren't familiar with the author's style or are just getting into Java. Context switching causes breaks in concentration. Not good.</p><p style="clear: both">In the refactored code, the developer can get to mouseClicked() and read once, "We want to do something when the user's primary button is double-clicked". No context switching, no breaks in concentration. Good.</p><p style="clear: both"><strong>Writing clean comments</strong></p><p style="clear: both">The next thing I read that was interesting was method level comments. Here is an example of my old method level comments that I would write to pass <a href="http://checkstyle.sourceforge.net/">Checkstyle</a> and document what my method exposes:</p><blockquote style="clear: both"><p>/**<br />* Returns true if the primary button is double-clicked.<br />* @param event the event wrapping the mouse state information<br />* @return true if the primary button is clicked, false if not.<br />*/<br /><strong>public void isPrimaryButtonDoubleClick(MouseEvent event){</strong><br /><br />return event.getButton() == MouseEvent.BUTTON1 &amp;&amp; event.getClickCount() == 2;<br /><br /><strong>}</strong></p></blockquote><p style="clear: both">There are three areas of duplication. First, my initial comment duplicates what the method name states. Second, the @return tag says the same thing. Finally, the method signature clearly states what my method does and returns. Since checkstyle requires a @return tag, here is my refactored method comments:</p><blockquote style="clear: both"><p>/**<br />* @param event the event wrapping the mouse state information.<br />* @return true if the primary button is clicked, false if not.<br />*/<br /><strong>public boolean isPrimaryButtonDoubleClick(MouseEvent event){</strong><br /><br />return event.getButton() == MouseEvent.BUTTON1 &amp;&amp; event.getClickCount() == 2;<br /><br /><strong>}</strong></p></blockquote><p style="clear: both">I removed the initial comment to reduce the comment duplication. If the method had no parameters, the code will be reduced further:</p><blockquote style="clear: both"><p>/** @return true if the primary button is clicked, false if not. */<br /><strong>public boolean isPrimaryButtonDoubleClick(){</strong><br /><br />return this.event.getButton() == MouseEvent.BUTTON1 &amp;&amp; this.event.getClickCount() == 2;<br /><br /><strong>}</strong></p></blockquote><p style="clear: both">It passes checkstyle and reduces the amount of comment duplication. I like it.</p><br class='final-break' style='clear: both' /></div>
